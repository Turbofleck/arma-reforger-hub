async function callGemini(prompt) {
    aiLoader.style.display = 'block';
    aiSendBtn.disabled = true;

    const fullPrompt = `Du bist ein Experte für Arma Reforger Server-Administration und Gameplay. Beantworte die folgende Frage kurz, präzise und hilfreich. Frage: "${prompt}"`;

    try {
        // Ruft unsere eigene, sichere Netlify-Funktion auf
        const response = await fetch('/.netlify/functions/call-gemini', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt: fullPrompt })
        });

        if (!response.ok) {
            throw new Error(`Serverless function failed with status ${response.status}`);
        }

        const result = await response.json();

        if (result.reply) {
            addMessage(result.reply, 'ai');
        } else {
            addMessage('Entschuldigung, ich konnte keine Antwort finden.', 'ai');
        }
    } catch (error) {
        console.error("API call failed:", error);
        addMessage('Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.', 'ai');
    } finally {
        aiLoader.style.display = 'none';
        aiSendBtn.disabled = false;
    }
}